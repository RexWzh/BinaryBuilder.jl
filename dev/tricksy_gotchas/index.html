<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>棘手的陷阱 · BinaryBuilder.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BinaryBuilder.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">主页</a></li><li><a class="tocitem" href="../building/">构建包</a></li><li><a class="tocitem" href="../build_tips/">构建提示</a></li><li><a class="tocitem" href="../jll/">JLL 包</a></li><li><a class="tocitem" href="../FAQ/">常见问题</a></li><li><a class="tocitem" href="../troubleshooting/">构建故障排除</a></li><li><span class="tocitem">内部</span><ul><li><a class="tocitem" href="../rootfs/">根文件系统</a></li><li><a class="tocitem" href="../environment_variables/">环境变量</a></li><li class="is-active"><a class="tocitem" href>棘手的陷阱</a></li><li><a class="tocitem" href="../reference/">引用</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">内部</a></li><li class="is-active"><a href>棘手的陷阱</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>棘手的陷阱</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RexWzh/BinaryBuilder.jl/blob/master/docs/src/tricksy_gotchas.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="棘手的陷阱"><a class="docs-heading-anchor" href="#棘手的陷阱">棘手的陷阱</a><a id="棘手的陷阱-1"></a><a class="docs-heading-anchor-permalink" href="#棘手的陷阱" title="Permalink"></a></h1><p>在二进制编译和分发时，存在大量问题需进行适当处理，否则二进制文件只能在某些机器上运行。以下是 <code>BinaryBuilder.jl</code> 自动为您处理的事情（不完整列表）：</p><ul><li>统一的编译器接口</li></ul><p>不用担心通过奇怪的名字调用编译器；只需在适当的环境中运行 <code>gcc</code>，您就会得到适当的交叉编译器。三元组前缀后的名称（例如 <code>x86_64-linux-gnu-gcc</code>）也可以用，并且所有平台都使用相同版本的 <code>gcc</code>、<code>g++</code> 和 <code>gfortran</code>。</p><ul><li><code>glibc</code> 版本控制</li></ul><p>在使用 <code>glibc</code> 作为 C 运行库的 Linux 平台上（在撰写本文时，这是绝大多数桌面和服务器发行版的情况），有必要针对比起将要运行的 <code>glibc</code> 版本更 <em>旧</em> 的版本编译代码。例如，如果您的代码是针对 <code>glibc v2.5</code> 编译的，它将在 <code>glibc v2.6</code> 上运行，但不会在 <code>glibc v2.4</code> 上运行。因此，为了最大限度地提高兼容性，所有代码都应尽可能针对旧版本的 <code>glibc</code> 进行编译。</p><ul><li><code>gfortran</code> 版本控制</li></ul><p>编译 FORTRAN 代码时，<code>gfortran</code> 编译器破坏了 6.X -&gt; 7.X 转换和 7.X -&gt; 8.X 转换中的 ABI 兼容性。这意味着使用 <code>gfortran</code> 6.X 构建的代码不能与使用 <code>gfortran</code> 7.X 构建的代码链接。因此，我们针对多个不同的 <code>gfortran</code> 版本编译所有 <code>gfortran</code> 代码，然后在运行时根据当前运行进程的已有链接决定下载哪个。</p><ul><li><code>cxx11</code> 字符串 ABI</li></ul><p>在 GCC 5 中从 <code>cxx03</code> 标准切换到 <code>cxx11</code> 时，<code>std::string</code> 对象的内部布局发生了变化。如果 C++ 代码不是使用相同的 C++ 字符串 ABI 构建的，这会导致在公共接口上来回传递字符串的 C++ 代码之间不兼容。因此，我们检测 <code>std::string</code> 对象何时被传递，并警告您需要构建两个不同版本，一个是具有 <code>cxx03</code> 样式的字符串（通过为较新的 GCC 版本设置 <code>-D_GLIBCXX_USE_CXX11_ABI=0</code> 来实现），另一个是带有 <code>cxx11</code> 风格的字符串。</p><ul><li>库依赖</li></ul><p>二进制分发中的一大问题是不正确的库链接。在构建依赖于另一个二进制对象的二进制对象时，一些操作系统（例如 macOS）将依赖库的绝对路径加入到依赖项中，而其他操作系统依赖默认搜索路径中的库。 <code>BinaryBuilder.jl</code> 通过自动发现这些错误并用目标平台的 <code>RPATH</code>/<code>RUNPATH</code> 语义来修复这个问题。请注意，这在技术上是一个构建系统错误，虽然我们会自动修复它，但它会在构建前缀审核期间发出一个温和的黄色警告。</p><ul><li>嵌入式绝对路径</li></ul><p>与库依赖项类似，普通文件（甚至符号链接）可以在其中嵌入文件的绝对位置。 <code>BinaryBuilder.jl</code> 会自动将构建前缀目录内文件的符号链接转换为等效的相对路径，如果前缀内的任何文件包含指向构建前缀的绝对路径，则会提醒您。虽然后者不能自动修复，但它可能有助于以后跟踪软件问题。</p><ul><li>指令集差异</li></ul><p>在编译随时间发展的体系结构（例如 <code>x86_64</code> ）时，确定正确的指令集为目标很重要，否则二进制文件可能包含将在编译所在计算机上运行的指令，但在没有新处理器的机器上运行出现异常错误。 <code>BinaryBuilder.jl</code> 将自动反汇编每个构建的二进制对象并检查所使用的指令，如果发现二进制文件不符合商定的最小指令集架构，则会警告用户。它还会注意到二进制文件是否包含 <code>cpuid</code> 指令，这表明二进制文件意识到此问题并将在内部切换为仅使用可用指令，是个好的迹象。</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../environment_variables/">« 环境变量</a><a class="docs-footer-nextpage" href="../reference/">引用 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 9 February 2023 12:31">Thursday 9 February 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
